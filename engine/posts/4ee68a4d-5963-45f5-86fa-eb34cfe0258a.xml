<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<post>
  <author>brianbruff</author>
  <title>Azure DB is much slower than AWS, why?</title>
  <description />
  <content>&lt;p&gt;This is a rather unusual post for me, while I’ve gone to the trouble of getting certified on both Azure and AWS platforms and try to make my posts on the same as unbiased as possible, the fact is that I’m pro Azure, and always have been, perhaps it’s because I’ve grown up on Microsoft Stacks, perhaps it’s because other platforms offer such a myriad of options that’s it not only hard to pick some, but getting the to work cohesively is beyond painful. &lt;/p&gt;  &lt;p&gt;Whether I remain pro Azure is at a tipping point as it appears I’m struggling to get Azure to offer the same performance when it comes to relational databases ( both with Oracle and Sql Server). Let me be clear that I don’t have all the answers for what I’m about to present, I have some ideas sure, but this post will not answer them, I simply intent to present a few scenarios with various applications that I’ve attempted to lift and shift to the cloud and why in a near like for like comparison with similar infrastructure with AWS, AWS is much much faster, in fact it’s near 2x faster!&lt;/p&gt;  &lt;h3&gt;Use cases&lt;/h3&gt;  &lt;p&gt;The following 3 scenarios behaved much better on AWS than Azure, we’re going to focus on 1 &amp;amp; 2 below and ignore the fact that the general responsiveness of the applications using Azure database we much worse (because we didn’t benchmark any of them).&lt;/p&gt;  &lt;ul&gt;   &lt;li&gt;Scenario 1: Writing 500MB raw numeric to DB in 5 records&lt;/li&gt;    &lt;li&gt;Scenario 2: Writing 1MB raw data to database&lt;/li&gt;    &lt;li&gt;Scenario 3: General responsiveness&lt;/li&gt; &lt;/ul&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;h4&gt;Scenario 1&lt;/h4&gt;  &lt;p&gt;The database of choice for this scenario was Oracle Standard Edition.&lt;/p&gt;  &lt;p&gt;Hardware Platforms&lt;/p&gt;  &lt;h5&gt;Laptop&lt;/h5&gt;  &lt;p&gt;Dual core hyper treaded i7 mobile chip. 2.9GHZ   &lt;br /&gt;16GB Ram    &lt;br /&gt;Local SSD ScanDisk, approx 90k IOPS&lt;/p&gt;  &lt;h5&gt;Azure&lt;/h5&gt;  &lt;p&gt;4 Core Xeon 2.4GHZ   &lt;br /&gt;14GB Ram    &lt;br /&gt;20K premium disks    &lt;br /&gt;12,8K IOPS throttle    &lt;br /&gt;&lt;/p&gt;  &lt;h5&gt;AWS&lt;/h5&gt;  &lt;p&gt;4 Core Xeon, 2.9GHZ   &lt;br /&gt;16GB RAM    &lt;br /&gt;20k provisioned I/O    &lt;br /&gt;Unadvertised throttling    &lt;br /&gt;&lt;/p&gt;  &lt;h5&gt;RESULTS&lt;/h5&gt;  &lt;table cellspacing="0" cellpadding="2" width="517" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="515"&gt;&lt;a href="./image.axd?picture=image_433.png"&gt;&lt;img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px 10px 0px 0px; display: inline; padding-right: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_434.png" width="504" height="92" /&gt;&lt;/a&gt;&lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;h6&gt;&lt;/h6&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;table cellspacing="0" cellpadding="2" width="745" border="1"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="743"&gt;TODO CHANGE NAME         &lt;br /&gt;azure          &lt;br /&gt;          &lt;p&gt;Processed 1387264 pages for database 'dbEonDev', file 'dbEonDev_Data' on file 1.           &lt;br /&gt;Processed 10 pages for database 'dbEonDev', file 'dbEonDev_Log' on file 1.            &lt;br /&gt;BACKUP DATABASE successfully processed 1387274 pages in 42.542 seconds (254.761 MB/sec).            &lt;br /&gt;&lt;/p&gt;       &lt;/td&gt;     &lt;/tr&gt;      &lt;tr&gt;       &lt;td valign="top" width="743"&gt;         &lt;p&gt;&amp;#160;&lt;/p&gt;          &lt;p&gt;&amp;#160;&lt;/p&gt;          &lt;p&gt;local&lt;/p&gt;          &lt;p&gt;Processed 1427504 pages for database 'dbEonDev', file 'dbEonDev_Data' on file 1.           &lt;br /&gt;Processed 8 pages for database 'dbEonDev', file 'dbEonDev_Log' on file 1.            &lt;br /&gt;BACKUP DATABASE successfully processed 1427512 pages in 28.870 seconds (386.298 MB/sec).            &lt;br /&gt;&lt;/p&gt;          &lt;p&gt;&amp;#160;&lt;/p&gt;          &lt;p&gt;&amp;#160;&lt;/p&gt;          &lt;p&gt;ec2&lt;/p&gt;          &lt;p&gt;Processed 1339168 pages for database 'dbEonDev', file 'dbEonDev_Data' on file 1.           &lt;br /&gt;Processed 2 pages for database 'dbEonDev', file 'dbEonDev_Log' on file 1.            &lt;br /&gt;BACKUP DATABASE successfully processed 1339170 pages in 86.767 seconds (120.578 MB/sec).&lt;/p&gt;       &lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;table cellspacing="0" cellpadding="2" width="40" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="40"&gt;&lt;a href="./image.axd?picture=image_426.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 10px 0px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_427.png" width="740" height="458" /&gt;&lt;/a&gt;&lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;&amp;#160;&amp;#160; &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;h3&gt;Azure&lt;/h3&gt;  &lt;p&gt;&lt;a href="./image.axd?picture=image_427.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_428.png" width="135" height="244" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;8k IOPS, on all workers&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;All workers:&lt;/p&gt;  &lt;table cellspacing="0" cellpadding="2" width="40" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="40"&gt;&lt;a href="./image.axd?picture=image_428.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 10px 0px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_429.png" width="788" height="501" /&gt;&lt;/a&gt;&lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;One Worker, started out with 80k IOPS, degrading to 14k over I minute run&lt;/p&gt;  &lt;table cellspacing="0" cellpadding="2" width="40" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="40"&gt;&lt;a href="./image.axd?picture=image_429.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 10px 0px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_430.png" width="777" height="494" /&gt;&lt;/a&gt;&lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;Azure premium&lt;/p&gt;  &lt;table cellspacing="0" cellpadding="2" width="40" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="40"&gt;&lt;a href="./image.axd?picture=image_430.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 10px 0px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_431.png" width="319" height="410" /&gt;&lt;/a&gt;&lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;Attached 6 disks, each 5k, for a total of 30k IOPS RAID0&lt;/p&gt;  &lt;table cellspacing="0" cellpadding="2" width="40" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="40"&gt;&lt;a href="./image.axd?picture=image_431.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_432.png" width="241" height="244" /&gt;&lt;/a&gt;&lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;h3&gt;&amp;#160;&lt;/h3&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;h3&gt;AWS&lt;/h3&gt;  &lt;p&gt;Provisioned 20k IOPS, getting 13.5K sustained&lt;/p&gt;  &lt;table cellspacing="0" cellpadding="2" width="40" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="40"&gt;&lt;a href="./image.axd?picture=image_432.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 10px 0px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_433.png" width="725" height="445" /&gt;&lt;/a&gt;&lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;C: Drive SSD (1TB 3k IOPS drive)&lt;/p&gt;  &lt;p&gt;Costs&lt;/p&gt;</content>
  <ispublished>False</ispublished>
  <isdeleted>False</isdeleted>
  <iscommentsenabled>True</iscommentsenabled>
  <pubDate>2016-07-11 14:01:31</pubDate>
  <lastModified>2016-07-26 13:05:18</lastModified>
  <raters>0</raters>
  <rating>0</rating>
  <slug>Battle-of-the-IOPS</slug>
  <tags />
  <comments />
  <categories />
  <notifications />
</post>
