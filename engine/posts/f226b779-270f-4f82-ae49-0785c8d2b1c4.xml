<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<post>
  <author>brianbruff</author>
  <title>Powershell Oracle Db Backup</title>
  <description />
  <content>&lt;p&gt;Hi all,&lt;/p&gt;  &lt;p&gt;I thought I would share with you this quick Powershell script I created to Export an oracle database, 7Zip it and then upload it to AmazonS3&lt;/p&gt;  &lt;h2&gt;Export.ps1&lt;/h2&gt;  &lt;table cellspacing="0" cellpadding="2" width="600" border="0"&gt;&lt;tbody&gt;     &lt;tr&gt;       &lt;td valign="top" width="600"&gt;         &lt;div style="font-size: 14px; font-family: consolas, &amp;#39;Courier New&amp;#39;, monospace; white-space: pre; font-weight: normal; color: #d4d4d4; line-height: 19px; background-color: #1e1e1e"&gt;            &lt;div&gt;&lt;span style="color: #c586c0"&gt;param&lt;/span&gt;&lt;span style="color: #569cd6"&gt;(&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;[String]&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt;=&lt;/span&gt;&lt;span style="color: #569cd6"&gt;(&lt;/span&gt;&lt;span style="color: #dcdcaa"&gt;get-date&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; -format dd-MM-yyyy&lt;/span&gt;&lt;span style="color: #569cd6"&gt;))&lt;/span&gt;&lt;/div&gt;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; &lt;div&gt;&lt;span style="color: #dcdcaa"&gt;Set-Alias&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; sz &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;env:ProgramFiles&lt;/span&gt;&lt;span style="color: #ce9178"&gt;\7-Zip\7z.exe&amp;quot;&lt;/span&gt;&lt;/div&gt;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; &lt;div&gt;&lt;span style="color: #d4d4d4"&gt;expdp &amp;lt;myDbUser&amp;gt;/&amp;lt;mypasswd&amp;gt; &lt;/span&gt;&lt;/div&gt;            &lt;div&gt;&lt;span style="color: #d4d4d4"&gt;&amp;#160;&amp;#160; &lt;/span&gt;&lt;span style="color: #d4d4d4"&gt;DIRECTORY=dmpdir DUMPFILE=&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #dcdcaa"&gt;.dmp&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; &lt;/span&gt;&lt;/div&gt;            &lt;div&gt;&lt;span style="color: #d4d4d4"&gt;&amp;#160;&amp;#160; LOGFILE=&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #dcdcaa"&gt;.log&lt;/span&gt;&lt;/div&gt;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; &lt;div&gt;&lt;span style="color: #d4d4d4"&gt;sz a -mx &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #ce9178"&gt;.7z&amp;quot;&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #ce9178"&gt;.*&amp;quot;&lt;/span&gt;&lt;/div&gt;            &lt;div&gt;&lt;span style="color: #dcdcaa"&gt;Write-S3Object&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; -bucket &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;company-ps&amp;quot;&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; &lt;/span&gt;&lt;/div&gt;            &lt;div&gt;&lt;span style="color: #d4d4d4"&gt;&amp;#160;&amp;#160; -profilename brian.keating &lt;/span&gt;&lt;/div&gt;            &lt;div&gt;&lt;span style="color: #d4d4d4"&gt;&amp;#160;&amp;#160; -file &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #ce9178"&gt;.7z&amp;quot;&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; -key &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;customer/dbdumps/&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #ce9178"&gt;.7z&amp;quot;&lt;/span&gt;&lt;/div&gt;            &lt;div&gt;&lt;span style="color: #dcdcaa"&gt;remove-item&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #ce9178"&gt;.dmp&amp;quot;&lt;/span&gt;&lt;/div&gt;            &lt;div&gt;&lt;span style="color: #dcdcaa"&gt;remove-item&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; &lt;/span&gt;&lt;span style="color: #ce9178"&gt;&amp;quot;&lt;/span&gt;&lt;span style="color: #569cd6"&gt;$&lt;/span&gt;&lt;span style="color: #9cdcfe"&gt;dumpname&lt;/span&gt;&lt;span style="color: #ce9178"&gt;.log&amp;quot;&lt;/span&gt;              &lt;br /&gt;              &lt;br /&gt;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; &lt;/div&gt;         &lt;/div&gt;       &lt;/td&gt;     &lt;/tr&gt;   &lt;/tbody&gt;&lt;/table&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;h2&gt;How it works:&lt;/h2&gt;  &lt;p&gt;It uses the current date as the dumpname variable (unless specified as a parameter to the script)&lt;/p&gt;  &lt;p&gt;It uses Oracle DbPump to export the database (assumes 7-Zip is installed in %\program files\)&lt;/p&gt;  &lt;p&gt;It then writes the 7z file to AWS S3&lt;/p&gt;  &lt;p&gt;Finally it removes the dump and log files.&lt;/p&gt;  &lt;h3&gt;AWS Powershell&lt;/h3&gt;  &lt;p&gt;ASW Powershell is installed on this server and I have already set a profile “brian.keating” with the following command.&lt;/p&gt;  &lt;div style="font-size: 14px; font-family: consolas, &amp;#39;Courier New&amp;#39;, monospace; white-space: pre; font-weight: normal; color: #d4d4d4; line-height: 19px; background-color: #1e1e1e"&gt;   &lt;div&gt;&lt;span style="color: #dcdcaa"&gt;set-awscredentials&lt;/span&gt;&lt;span style="color: #d4d4d4"&gt; –AccessKey &amp;lt;ACCESSKEY&amp;gt; –SecretKey &amp;lt;KEY&amp;gt; -storeAs brian.keating&lt;/span&gt;&lt;/div&gt; &lt;/div&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;h2&gt;Trivia&lt;/h2&gt;  &lt;p&gt;The server in this case is running in AWS, the 7zipped db is about 4Gb, and it uploads to S3 in about 30seconds (nice!)&lt;/p&gt;</content>
  <ispublished>True</ispublished>
  <isdeleted>False</isdeleted>
  <iscommentsenabled>True</iscommentsenabled>
  <pubDate>2017-04-25 08:50:15</pubDate>
  <lastModified>2017-04-25 08:50:15</lastModified>
  <raters>0</raters>
  <rating>0</rating>
  <slug>Powershell-Oracle-Db-Backup</slug>
  <tags>
    <tag>Oracle Export 7-Zip and upload to S3</tag>
  </tags>
  <comments />
  <categories>
    <category>0d55a24e-db67-40a3-af5b-1a77c336bece</category>
    <category>43afee58-4946-4ced-8461-622c772af161</category>
  </categories>
  <notifications />
</post>