<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<post>
  <author>brianbruff</author>
  <title>File Upload MCV4 Web API, Knockout.js</title>
  <description />
  <content>&lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;I wish to follow up on my previous post &lt;a href="/post/2012/04/04/Uploading-a-file-in-MVC4-C5-NET-45.aspx"&gt;Uploading a file in MVC4 C#5 .NET 4.5&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;I promised a few things here, an Ajax client, WinRT, iOs, Droid, This post addresses the ajax upload.&lt;/p&gt;  &lt;p&gt;First some background, I’m working on an expense tracking system at the moment, the core technologies involved in this Single Page Application are:&lt;/p&gt;  &lt;ul&gt;   &lt;li&gt;ASP MVC4 WebApi &lt;/li&gt;    &lt;li&gt;Html5 SPA &lt;/li&gt;    &lt;li&gt;Knockout.js &lt;/li&gt; &lt;/ul&gt;  &lt;p&gt;A fundamental part of this system is the ability to upload receipts.    &lt;br /&gt;&amp;#160;&lt;a href="./image.axd?picture=image_255.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_255.png" width="481" height="310" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;When the user browses to an image file, it gets converted to base64 and uploaded via a MVC4 Api controller.&lt;/p&gt;  &lt;p&gt;Here are the important parts:&lt;/p&gt;  &lt;h2&gt;Html&lt;/h2&gt;  &lt;p&gt;&lt;a href="./image.axd?picture=image_256.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_256.png" width="673" height="155" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;First we create an image where we can display either the previously selected image or the newly selected image.    &lt;br /&gt;We only display this image if it’s in the javascript model.&lt;/p&gt;  &lt;p&gt;Secondly we bind the html5 input file with a knockout binding.&lt;/p&gt;  &lt;h2&gt;Javascript&lt;/h2&gt;  &lt;h3&gt;Model&lt;/h3&gt;  &lt;p&gt;&lt;a href="./image.axd?picture=image_257.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_257.png" width="436" height="299" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;The important parts are the image and imageType properties, there also exists a computed property that joins these two so it can be displayed in an image tag. The reason i keep these separated is that I can’t post the source as is without further encoding.&lt;/p&gt;  &lt;h3&gt;Knockout Bindings&lt;/h3&gt;  &lt;p&gt;In knockout.js you are not limited to the built in bindings like, click and value, you can create your own,    &lt;br /&gt;I’ve taken &lt;a href="https://github.com/khayrov/khayrov.github.com/blob/master/jsfiddle/knockout-fileapi/ko_file.js"&gt;https://github.com/khayrov/khayrov.github.com/blob/master/jsfiddle/knockout-fileapi/ko_file.js&lt;/a&gt; as my start point, this pretty much does what I want, however I made a slight tweak in that i wanted base64. (basically because I’ve written some of the objective-C iOS app already and didn’t fancy changing it).&lt;/p&gt;  &lt;p&gt;&amp;#160;&lt;/p&gt;  &lt;p&gt;&lt;a href="./image.axd?picture=image_258.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_258.png" width="577" height="518" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;h2&gt;WebApi&lt;/h2&gt;  &lt;p&gt;&lt;a href="./image.axd?picture=image_259.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_259.png" width="575" height="508" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;h4&gt;ExpenseDto&lt;/h4&gt;  &lt;p&gt;&lt;a href="./image.axd?picture=image_260.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="./image.axd?picture=image_thumb_260.png" width="244" height="49" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;All source can be viewed @ &lt;a href="https://github.com/brianbruff/Expenses"&gt;https://github.com/brianbruff/Expenses&lt;/a&gt;&lt;/p&gt;</content>
  <ispublished>True</ispublished>
  <isdeleted>False</isdeleted>
  <iscommentsenabled>True</iscommentsenabled>
  <pubDate>2013-04-22 13:43:00</pubDate>
  <lastModified>2015-07-09 11:03:11</lastModified>
  <raters>0</raters>
  <rating>0</rating>
  <slug>File-Upload-with-MCV4-Web-API-and-Knockoutjs</slug>
  <tags>
    <tag>Fileupload in SPA WebApi</tag>
  </tags>
  <comments />
  <categories />
  <notifications />
</post>